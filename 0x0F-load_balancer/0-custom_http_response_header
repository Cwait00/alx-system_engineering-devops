#!/usr/bin/env bash
# This script configures Nginx with a custom HTTP response header on a new Ubuntu machine

# Install Nginx
sudo apt-get update
sudo apt-get install -y nginx

# Set the hostname
HOSTNAME=$(hostname)

# Create a new Nginx configuration file for web-02
sudo bash -c 'cat << EOF > /etc/nginx/sites-available/web-02
server {
    listen 80;
    listen [::]:80;

    server_name _;

    location /hbnb_static {
        alias /data/web_static/current/;
    }

    add_header X-Served-By $HOSTNAME;

    location / {
        proxy_pass http://localhost:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
EOF'

# Create a symbolic link to enable the new configuration
sudo ln -sf /etc/nginx/sites-available/web-02 /etc/nginx/sites-enabled/

# Restart Nginx
sudo service nginx restart
